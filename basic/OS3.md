#### 《操作系统》 课程作业3

**1.什么是临界资源？什么是临界区？**

临界资源：系统中某些共享资源**一次只允许一个进程使用**，称这样的资源为临界资源，**硬件**临界资源如**打印机、光盘刻录机**，**软件**临界资源如**只能互斥访问的变量、表格、队列**，并非所有共享资源都是临界资源，如**只读数据**；
临界区：进程中访问临界资源的代码片断，由进入区和退出区代码包络保护。

**2.什么是信号量？信号量s的计数值s.count＞0，s.count＝0和s.count＜0的意义分别是什么？**

信号量是操作系统用来**解决并发中的互斥和同步问题**的一种方法，其数据结构为一个**整型变量**s.count以及一个进程等待**队列**s.queue，队列中是阻塞在该信号量上的各个进程的标识。
s.count>0表示**有count个资源可用**，s.count=0则表示**无资源可用**，s.count<0则|count|表示s**等待队列中的进程个数**。

**3.当低优先级进程正处在临界区之中时，如果高优先级进程变为就绪并被调度，若采用忙等则产生优先级反转问题。优先级反转问题是否也适用于线程？分别考虑ULT和KLT。**

优先级反转：**高优先级任务被低优先级任务阻塞**，但**其他中等优先级的任务却可能抢占低优先级任务的CPU资源**，导致高优先级任务迟迟得不到调度；

ULT:用户级线程与操作系统内核无关，调度工作由应用程序而非硬件完成，在用户空间内实现，在遇到更高（中）优先级，且不存在互斥关系（不需等待获取当前低优先级线程的互斥锁）的线程时不会被抢占CPU，故优先级反转问题**不适用**；

KLT:内核级线程由内核直接管理，调度由操作系统完成，与进程情况相同，优先级反转问题**适用**。

**4.假使A、B两个火车站之间是单线铁路，许多列车可以同时到达A站，然后经A站到B站，又列车从A到B的行驶时间是t，列车到B站后的停留时间是t/2。在该问题模型中，哪些是临界资源？**

A,B间的单线铁路的**前半段**是临界资源，因为该资源为许多列车的共享资源，而一次只允许一趟列车使用，列车在离开A站瞬间取得该资源，在运行到半程时方可放弃该资源，否则相邻列车距离过小，将会在B站发生堵塞。具体而言，整段铁路最多可以允许2部列车同时运行，而这两部列车的间隔必须不小于铁路长度的一半（相当于时间的t/2），这样可以保证列车到达B站时，上一趟列车已经完成t/2的停留离开B站或恰好将离开B站。

**5.苹果-桔子问题：桌子上有一只盘子，每次只能向其中放入一个水果，要求：<u>爸爸专向盘子里放苹果，女儿专等吃盘子中的苹果；妈妈专向盘子里放桔子，儿子专等吃盘子中的桔子；只有盘子为空时，爸爸或妈妈才可向盘子中放入一个水果；仅当盘子中有自己需要的水果时，儿子或女儿可以从盘子中取出。</u>使用信号量和P、V操作使爸爸、妈妈、儿子和女儿正确同步工作。**

```c
EMP.count = 1; //空位数
MAN.count = 0; //苹果数
NAR.count = 0; //桔子数
void P(s){
  --s.count;
  if (s.count < 0){
    调用进程进入等待队列s.queue;
    阻塞调用进程;
  }
}
void V(s){
  ++s.count;
  if (s.count <= 0){
    从等待队列s.queue中取出一个进程P;
    进程P进入就绪队列;
  }
}
// 爸爸的操作:等候并拿到“空盘”锁，执行“放苹果”，给出“苹果”锁（给女儿）
void papa(){
  while(true){
    P(EMP);
    putManzana();
    V(MAN);
  }
}
// 妈妈的操作:等候并拿到“空盘”锁，执行“放桔子”，给出“桔子”锁（给儿子）
void mama(){
  while(true){
    P(EMP);
    putNaranja();
    V(NAR);
  }
}
// 女儿的操作:等候并拿到“苹果”锁，执行“吃苹果”，给出“空盘”锁（给爸爸）
void hija(){
  while(true){
    P(MAN);
    getManzana();
    V(EMP);
  }
}
// 儿子的操作:等候并拿到“桔子”锁，执行“吃桔子”，给出“空盘”锁（给妈妈）
void hijo(){
  while(true){
    P(NAR);
    getNaranja();
    V(EMP);
  }
}
```